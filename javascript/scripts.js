"use strict";

(function(){
  
  let queryBox = document.getElementById("guardQuery");
  let searchForm = document.getElementById("searchForm");
  let demoJSON = document.getElementById("demo");

  // get an api key from http://open-platform.theguardian.com/access/
  let baseURL = "https://content.guardianapis.com/search?api-key=<{"response":{"status":"ok","userTier":"developer","total":1996946,"startIndex":1,"pageSize":10,"currentPage":1,"pages":199695,"orderBy":"newest","results":[{"id":"business/live/2017/nov/28/bank-of-england-stress-tests-financial-stability-released-live","type":"liveblog","sectionId":"business","sectionName":"Business","webPublicationDate":"2017-11-28T10:54:17Z","webTitle":"Stress tests: Bank of England warns disorderly Brexit would be painful - live!","webUrl":"https://www.theguardian.com/business/live/2017/nov/28/bank-of-england-stress-tests-financial-stability-released-live","apiUrl":"https://content.guardianapis.com/business/live/2017/nov/28/bank-of-england-stress-tests-financial-stability-released-live","isHosted":false},{"id":"politics/blog/live/2017/nov/28/priti-patel-condemns-mays-brexit-strategy-and-says-eu-should-be-told-to-sod-off-over-money-politics-live","type":"liveblog","sectionId":"politics","sectionName":"Politics","webPublicationDate":"2017-11-28T10:51:06Z","webTitle":"Priti Patel condemns May's Brexit strategy and says EU should be told to 'sod off' over money - Politics live","webUrl":"https://www.theguardian.com/politics/blog/live/2017/nov/28/priti-patel-condemns-mays-brexit-strategy-and-says-eu-should-be-told-to-sod-off-over-money-politics-live","apiUrl":"https://content.guardianapis.com/politics/blog/live/2017/nov/28/priti-patel-condemns-mays-brexit-strategy-and-says-eu-should-be-told-to-sod-off-over-money-politics-live","isHosted":false},{"id":"music/live/2017/nov/28/aria-awards-2017-gang-of-youths-paul-kelly-ab-original-harry-styles-and-more-live","type":"liveblog","sectionId":"music","sectionName":"Music","webPublicationDate":"2017-11-28T10:49:24Z","webTitle":"Aria awards 2017: Gang of Youths, Paul Kelly, AB Original, Harry Styles and more – live","webUrl":"https://www.theguardian.com/music/live/2017/nov/28/aria-awards-2017-gang-of-youths-paul-kelly-ab-original-harry-styles-and-more-live","apiUrl":"https://content.guardianapis.com/music/live/2017/nov/28/aria-awards-2017-gang-of-youths-paul-kelly-ab-original-harry-styles-and-more-live","isHosted":false,"pillarId":"pillar/arts","pillarName":"Arts"},{"id":"football/blog/2017/nov/28/womens-football-blog-derby-county-ladies-journalism-scholarships","type":"article","sectionId":"football","sectionName":"Football","webPublicationDate":"2017-11-28T10:30:02Z","webTitle":"How to get more women into football (and football journalism)? Derby may have the answer","webUrl":"https://www.theguardian.com/football/blog/2017/nov/28/womens-football-blog-derby-county-ladies-journalism-scholarships","apiUrl":"https://content.guardianapis.com/football/blog/2017/nov/28/womens-football-blog-derby-county-ladies-journalism-scholarships","isHosted":false,"pillarId":"pillar/sport","pillarName":"Sport"},{"id":"uk-news/undercover-with-paul-lewis-and-rob-evans/2017/nov/28/how-a-met-police-spys-fake-identity-was-rumbled","type":"article","sectionId":"uk-news","sectionName":"UK news","webPublicationDate":"2017-11-28T10:27:10Z","webTitle":"How a Met police spy's fake identity was rumbled | Rob Evans","webUrl":"https://www.theguardian.com/uk-news/undercover-with-paul-lewis-and-rob-evans/2017/nov/28/how-a-met-police-spys-fake-identity-was-rumbled","apiUrl":"https://content.guardianapis.com/uk-news/undercover-with-paul-lewis-and-rob-evans/2017/nov/28/how-a-met-police-spys-fake-identity-was-rumbled","isHosted":false},{"id":"media/2017/nov/28/huffpost-australia-staff-fear-future-fairfax-talks","type":"article","sectionId":"media","sectionName":"Media","webPublicationDate":"2017-11-28T10:23:21Z","webTitle":"HuffPost Australia staff fear for future amid talks with partner Fairfax","webUrl":"https://www.theguardian.com/media/2017/nov/28/huffpost-australia-staff-fear-future-fairfax-talks","apiUrl":"https://content.guardianapis.com/media/2017/nov/28/huffpost-australia-staff-fear-future-fairfax-talks","isHosted":false},{"id":"technology/2017/nov/28/facebook-to-hand-over-details-of-russian-backed-brexit-posts","type":"article","sectionId":"technology","sectionName":"Technology","webPublicationDate":"2017-11-28T10:20:25Z","webTitle":"Facebook to hand over details of Russian-backed Brexit posts","webUrl":"https://www.theguardian.com/technology/2017/nov/28/facebook-to-hand-over-details-of-russian-backed-brexit-posts","apiUrl":"https://content.guardianapis.com/technology/2017/nov/28/facebook-to-hand-over-details-of-russian-backed-brexit-posts","isHosted":false},{"id":"world/2017/nov/28/irish-pm-leo-varadkar-talks-opposition-avert-government-collapse","type":"article","sectionId":"world","sectionName":"World news","webPublicationDate":"2017-11-28T10:13:25Z","webTitle":"Irish PM holds talks with opposition to avert government collapse","webUrl":"https://www.theguardian.com/world/2017/nov/28/irish-pm-leo-varadkar-talks-opposition-avert-government-collapse","apiUrl":"https://content.guardianapis.com/world/2017/nov/28/irish-pm-leo-varadkar-talks-opposition-avert-government-collapse","isHosted":false},{"id":"football/2017/nov/28/arsenal-arsene-wenger","type":"article","sectionId":"football","sectionName":"Football","webPublicationDate":"2017-11-28T10:11:03Z","webTitle":"Arsène Wenger rules out selling Alexis Sánchez and Mesut Özil in January","webUrl":"https://www.theguardian.com/football/2017/nov/28/arsenal-arsene-wenger","apiUrl":"https://content.guardianapis.com/football/2017/nov/28/arsenal-arsene-wenger","isHosted":false,"pillarId":"pillar/sport","pillarName":"Sport"},{"id":"uk-news/2017/nov/28/london-needs-more-gender-neutral-public-toilets-says-mayors-plan","type":"article","sectionId":"uk-news","sectionName":"UK news","webPublicationDate":"2017-11-28T10:00:31Z","webTitle":"London needs more gender-neutral public toilets, says mayor's plan","webUrl":"https://www.theguardian.com/uk-news/2017/nov/28/london-needs-more-gender-neutral-public-toilets-says-mayors-plan","apiUrl":"https://content.guardianapis.com/uk-news/2017/nov/28/london-needs-more-gender-neutral-public-toilets-says-mayors-plan","isHosted":false}]}}>&q=";

  searchForm.addEventListener("submit", function(ev){
    let url = baseURL + queryBox.value;
    let request = new Request(url);
    fetch(request)
      .then(function (response) {
        // console.log(`response: ${response.status}`);
        return response.json();
      })
      .then(function(data) {
        // console.log(data);
        let key;
        let theData = "";
        let tmp = data.response.results;
        for (key in tmp) {
          theData += `<li><a href="${tmp[key].webUrl}">${tmp[key].webTitle}</a> ${tmp[key].webPublicationDate}</li>`;
        }
        demoJSON.innerHTML = theData;
      });
	  queryBox.value = "";
    ev.preventDefault();
  }, false);

}());
